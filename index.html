<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Proposition de prestation</title>
<style>
:root {
    --primary-color: #007BFF;
    --text-color: #000000;
    --bg-color: #ffffff;
    --btn-accept: #28a745;
    --btn-refuse: #dc3545;
}

body {
    font-family: Arial, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    min-height: 100vh;
    margin: 0;
    padding: 10px;
    box-sizing: border-box;
    transition: background-color 0.3s, color 0.3s;
}

.wrapper {
    position: relative;
    max-width: 520px;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.theme-container {
    display: flex;
    justify-content: flex-end;
    width: 100%;
    margin-bottom: 10px;
}

.theme-btn {
    width: 40px;
    height: 40px;
    margin-left: 5px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.3s;
}
#lightBtn { background: #FFD700; } 
#darkBtn { background: #4B0082; color: #fff; }

.container {
    position: relative;
    background-color: var(--bg-color);
    color: var(--text-color);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    width: 100%;
    max-width: 500px;
    text-align: center;
    border: 2px solid transparent;
    transition: background-color 0.3s, color 0.3s, border 0.3s;
    box-sizing: border-box;
}

.container.dark {
    border: 2px solid #fff;
}

.logo {
    width: 120px;
    height: auto;
    margin-bottom: 20px;
}

button {
    padding: 10px 20px;
    margin: 10px 5px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
}
button.accept { background-color: var(--btn-accept); color: #fff; }
button.refuse { background-color: var(--btn-refuse); color: #fff; }
button.backBtn { background-color: #6c757d; color: #fff; }

.hidden { display: none; }

input, textarea, select {
    width: 80%;
    max-width: 400px;
    padding: 10px;
    margin: 10px auto;
    display: block;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 14px;
    box-sizing: border-box;
    resize: vertical;
}

body.dark, .container.dark {
    --bg-color: #000000;
    --text-color: #ffffff;
}
</style>
</head>
<body>

<div class="wrapper">
    <div class="theme-container">
        <button class="theme-btn" id="lightBtn">‚òÄÔ∏è</button>
        <button class="theme-btn" id="darkBtn">üåô</button>
    </div>

    <div class="container" id="mainContainer">
        <img src="ash-tech_logo.jpg" alt="Logo" class="logo">
        <h2>Proposition de prestation en attente de validation</h2>
        <button class="accept" id="acceptBtn">J'accepte la prestation</button>
        <button class="refuse" id="refuseBtn">Je refuse la prestation</button>
    </div>
</div>

<script>
const mainContainer = document.getElementById('mainContainer');
const lightBtn = document.getElementById('lightBtn');
const darkBtn = document.getElementById('darkBtn');
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

let pageHistory = [];

function goBack() {
    if (pageHistory.length > 0) {
        const lastPage = pageHistory.pop();
        mainContainer.innerHTML = lastPage;
        attachEventHandlers();
    }
}

lightBtn.addEventListener('click', () => {
    document.body.classList.remove('dark');
    mainContainer.classList.remove('dark');
});

darkBtn.addEventListener('click', () => {
    document.body.classList.add('dark');
    mainContainer.classList.add('dark');
});

function navigateTo(contentHTML) {
    pageHistory.push(mainContainer.innerHTML);
    mainContainer.innerHTML = contentHTML;
    attachEventHandlers();
}

function attachEventHandlers() {
    const backBtn = document.getElementById('backBtn');
    if(backBtn) backBtn.addEventListener('click', goBack);

    const acceptBtn = document.getElementById('acceptBtn');
    if(acceptBtn) acceptBtn.addEventListener('click', acceptFlow);

    const refuseBtn = document.getElementById('refuseBtn');
    if(refuseBtn) refuseBtn.addEventListener('click', refuseFlow);

    const sendAcceptBtn = document.getElementById('sendAcceptBtn');
    if(sendAcceptBtn) sendAcceptBtn.addEventListener('click', () => {
        const firstName = document.getElementById('firstName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const email = document.getElementById('email').value.trim();

        if(!firstName || !lastName || !email) {
            alert("Veuillez remplir tous les champs requis (Nom, Pr√©nom et Email).");
            return;
        }

        const bodyMessage = encodeURIComponent(
            `Bonjour,\n\nJe confirme que j'accepte votre proposition de prestation.\n\nNom: ${lastName}\nPr√©nom: ${firstName}\nT√©l√©phone: ${phone}\nEmail: ${email}`
        );

        if (isMobile) {
            const sendOption = document.getElementById('sendOption').value;
            if (sendOption === 'whatsapp') {
                window.open(`https://wa.me/22896933995?text=${bodyMessage}`);
            } else {
                window.open(`mailto:martindetours98@gmail.com?subject=Acceptation%20Prestation&body=${bodyMessage}`);
            }
        } else {
            window.open(`mailto:martindetours98@gmail.com?subject=Acceptation%20Prestation&body=${bodyMessage}`);
        }
        alert('Votre r√©ponse est pr√™te pour envoi !');
    });

    const sendIssueBtn = document.getElementById('sendIssueBtn');
    if(sendIssueBtn) sendIssueBtn.addEventListener('click', () => {
        const message = document.getElementById('issueText').value.trim();
        if(!message) {
            alert("Veuillez d√©crire le probl√®me avant d'envoyer.");
            return;
        }
        const encodedMessage = encodeURIComponent(message);
        if(isMobile) {
            window.open(`https://wa.me/22896933995?text=${encodedMessage}`);
        } else {
            window.open(`mailto:martindetours98@gmail.com?subject=Probl√®me%20Prestation&body=${encodedMessage}`);
        }
        alert('Merci, votre message a √©t√© pr√©par√© pour envoi.');
    });

    const stopBtn = document.getElementById('stopBtn');
    if(stopBtn) stopBtn.addEventListener('click', () => {
        navigateTo(`
            <img src="ash-tech_logo.jpg" alt="Logo" class="logo">
            <h3>Merci pour votre temps. √Ä bient√¥t !</h3>
            <button class="backBtn" id="backBtn">Retour</button>
        `);
    });

    const issueBtn = document.getElementById('issueBtn');
    if(issueBtn) issueBtn.addEventListener('click', () => {
        navigateTo(`
            <img src="ash-tech_logo.jpg" alt="Logo" class="logo">
            <h3>Expliquez la situation</h3>
            <textarea id="issueText" placeholder="D√©crivez le probl√®me ici..."></textarea>
            <button id="sendIssueBtn">Envoyer</button>
            <button class="backBtn" id="backBtn">Retour</button>
        `);
    });

    const newLight = document.getElementById('lightBtn');
    const newDark = document.getElementById('darkBtn');
    if(newLight) newLight.addEventListener('click', () => {
        document.body.classList.remove('dark');
        mainContainer.classList.remove('dark');
    });
    if(newDark) newDark.addEventListener('click', () => {
        document.body.classList.add('dark');
        mainContainer.classList.add('dark');
    });
}

// Refus
function refuseFlow() {
    navigateTo(`
        <img src="ash-tech_logo.jpg" alt="Logo" class="logo">
        <h3>Vous avez refus√© la prestation</h3>
        <p>Voulez-vous arr√™ter d√©finitivement la collaboration ou y a-t-il un souci avec le prix/prestation ?</p>
        <button id="stopBtn">Arr√™t d√©finitif</button>
        <button id="issueBtn">Il y a un souci</button>
        <button class="backBtn" id="backBtn">Retour</button>
    `);
}

// Acceptation
function acceptFlow() {
    let extraMessage = '';
    if(isMobile) {
        extraMessage = `<p>Vous pouvez envoyer votre r√©ponse par WhatsApp (par d√©faut) ou Mail.</p>
        <select id="sendOption">
            <option value="whatsapp" selected>WhatsApp</option>
            <option value="mail">Mail</option>
        </select>`;
    } else {
        extraMessage = `<p>L'envoi se fera uniquement par Mail.</p>`;
    }

    navigateTo(`
        <img src="ash-tech_logo.jpg" alt="Logo" class="logo">
        <h3>Merci d'accepter la prestation !</h3>
        ${extraMessage}
        <input type="text" id="firstName" placeholder="Pr√©nom" required>
        <input type="text" id="lastName" placeholder="Nom" required>
        <input type="tel" id="phone" placeholder="Num√©ro de t√©l√©phone">
        <input type="email" id="email" placeholder="Adresse mail" required>
        <button id="sendAcceptBtn">Envoyer la r√©ponse</button>
        <button class="backBtn" id="backBtn">Retour</button>
    `);
}

attachEventHandlers();
</script>

</body>
</html>
